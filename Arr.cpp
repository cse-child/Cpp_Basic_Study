#include "Arr.h"

#include <iostream>

// 배열 초기화 함수
void InitArr(tArr* _pArr) 
{
	_pArr->pInt = (int*)malloc(sizeof(int)*2);
	_pArr->iCount = 0;
	_pArr->iMaxCount = 2;
}

// 데이터 추가 함수
void PushBack(tArr * _pArr, int _iData)
{
	// 힙 영역에 할당한 공간이 다 참
	if (_pArr->iMaxCount <= _pArr->iCount) 
	{
		// 재할당
		Reallocate(_pArr);
	}

	// 데이터 추가
	_pArr->pInt[_pArr->iCount++] = _iData;
}

// 배열의 공간 추가 확장 함수 (재할당)
void Reallocate(tArr * _pArr)
{
	// 1. 2배 더 큰 공간을 동적할당한다.
	int* pNew = (int*)malloc(_pArr->iMaxCount * 2 * sizeof(int));
	// 새로운 메모리 공간을 지역변수 pNew에 먼저 저장시켜둔다.
	// pInt에 바로 재할당을 하면 pInt에 원래 할당되어있던 주소는
	// 더이상 사용되지 않고 사라지게 된다.

	// 2. 기존 공간에 있던 데이터들을 새로 할당한 공간으로 복사시킨다.
	for (int i = 0; i < _pArr->iCount; ++i)
	{
		pNew[i] = _pArr->pInt[i];
	}

	// 3. 기존 공간은 메모리 해제
	free(_pArr->pInt);

	// 4. 배열이 새로 할당된 공간을 가리키게 한다.
	_pArr->pInt = pNew;

	// 5. MaxCount 변경점 적용
	_pArr->iMaxCount *= 2;
}

// 배열 메모리 해제 함수
void ReleaseArr(tArr * _pArr)
{
	free(_pArr->pInt);
	_pArr->iCount = 0;
	_pArr->iMaxCount = 0;
}
